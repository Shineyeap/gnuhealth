<?xml version="1.0"?>
<tryton>
    <data>

<!-- Create the GNU HEALTH icon -->
        
        <record model="ir.ui.icon" id="lab_icon">
            <field name="name">medical-lab</field>
            <field name="path">icons/lab_icon.svg</field>
        </record>

        <menuitem name="Laboratory" parent="medical.medical_conf_menu"
            id="medical_conf_laboratory" sequence="3" icon="medical-lab"/>
        <menuitem name="Laboratory" parent="medical.medical_menu"
            id="medical_laboratory_menu" sequence="4" icon="medical-lab"/>

<!-- Lab Test Units -->

        <record model="ir.ui.view" id="medical_lab_unit_form">
            <field name="model">medical.lab.test.units</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <![CDATA[
                <form string="Test Unit">
                    <label name="name"/>
                    <field name="name"/>
                    <label name="code"/>
                    <field name="code"/>
                </form>
                ]]>
            </field>
        </record>

        <record model="ir.ui.view" id="medical_lab_unit_tree">
            <field name="model">medical.lab.test.units</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <![CDATA[
                <tree string="Test Unit">
                    <field name="name"/>
                    <field name="code"/>
                </tree>
                ]]>
            </field>
        </record>
        
        <record model="ir.action.act_window" id="medical_action_lab_unit">
            <field name="name">Lab Testing Units</field>
            <field name="res_model">medical.lab.test.units</field>
        </record>

        <record model="ir.action.act_window.view" id="medical_action_lab_unit_tree_view">
            <field name="sequence" eval="10"/>
            <field name="view" ref="medical_lab_unit_tree"/>
            <field name="act_window" ref="medical_action_lab_unit"/>
        </record>
        <record model="ir.action.act_window.view" id="medical_action_lab_unit_form_view">
            <field name="sequence" eval="20"/>
            <field name="view" ref="medical_lab_unit_form"/>
            <field name="act_window" ref="medical_action_lab_unit"/>
        </record>

        <menuitem parent="medical_conf_laboratory" action="medical_action_lab_unit"
            id="medical_labtest_unit"/>

<!-- Lab Requests -->

        <record model="ir.ui.view" id="medical_lab_test_request_form">
            <field name="model">medical.patient.lab.test</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <![CDATA[
                <form string="Test Requests">
                    <label name="name"/>
                    <field name="name"/>
                    <label name="date"/>
                    <field name="date"/>
                    <label name="patient_id"/>
                    <field name="patient_id"/>
                    <label name="doctor_id"/>
                    <field name="doctor_id"/>
                    <label name="state"/>
                    <field name="state" readonly="1"/>
                </form>
                ]]>
            </field>
        </record>

        <record model="ir.ui.view" id="medical_lab_test_request_tree">
            <field name="model">medical.patient.lab.test</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <![CDATA[
                <tree string="Test Requests"
                    colors="If(Equal(Eval('state'), 'draft'), 'blue', If(In(Eval('state'), ['cancel','open']), 'gray', 'black'))">
                    <field name="name"/>
                    <field name="date"/>
                    <field name="patient_id"/>
                    <field name="doctor_id"/>
                    <field name="state" readonly="1"/>
                </tree>
                ]]>
            </field>
        </record>

        <record model="ir.action.act_window" id="medical_action_lab_test_request">
            <field name="name">Lab Requests</field>
            <field name="res_model">medical.patient.lab.test</field>
            <field name="context">{'group_by': [], 'search_default_today': 1, 'search_default_draft': 1}</field>
        </record>

        <record model="ir.action.act_window.view" id="medical_action_lab_test_request_tree_view">
            <field name="sequence" eval="10"/>
            <field name="view" ref="medical_lab_test_request_tree"/>
            <field name="act_window" ref="medical_action_lab_test_request"/>
        </record>
        <record model="ir.action.act_window.view" id="medical_action_lab_test_request_form_view">
            <field name="sequence" eval="20"/>
            <field name="view" ref="medical_lab_test_request_form"/>
            <field name="act_window" ref="medical_action_lab_test_request"/>
        </record>

        <menuitem parent="medical_laboratory_menu" action="medical_action_lab_test_request"
            id="medical_labtest_request"/>



<!-- Lab Test Type -->

        <record model="ir.ui.view" id="medical_test_view">
            <field name="model">medical.test_type</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <![CDATA[
                <form string="Lab Test">
                    <notebook>
                        <page string="Main Info" id="test_type_main_info">
                            <label name="name"/>
                            <field name="name"/>
                            <label name="code"/>
                            <field name="code"/>
                            <field name="critearea" colspan="4">
                                <tree string="Test Cases">
                                    <field name="sequence"/>
                                    <field name="name"/>
                                    <field name="normal_range"/>
                                    <field name="units"/>
                                </tree>
                                <form string="Test Cases">
                                    <label name="name"/>
                                    <field name="name"/>
                                    <label name="units"/>
                                    <field name="units"/>
                                    <label name="sequence"/>
                                    <field name="sequence"/>
                                    <newline/>
                                    <label name="normal_range"/>
                                    <field name="normal_range"/>
                                </form>
                            </field>
                            <label name="product_id"/>
                            <field name="product_id"/>
                        </page>
                        <page string="Extra Info" id="test_type_extra_info">
                            <label name="info"/>
                            <field name="info"/>
                        </page>
                    </notebook>
                </form>
                ]]>
            </field>
        </record>

        <record model="ir.ui.view" id="medical_test_tree">
            <field name="model">medical.test_type</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <![CDATA[
                <tree string='Lab test type'>
                    <field name="name"/>
                    <field name="code"/>
                </tree>
                ]]>
            </field>
        </record>

        <record model="ir.action.act_window" id="medical_action_list_test">
            <field name="name">List of Lab tests</field>
            <field name="res_model">medical.test_type</field>
        </record>

        <record model="ir.action.act_window.view" id="medical_action_list_test_tree_view">
            <field name="sequence" eval="10"/>
            <field name="view" ref="medical_test_tree"/>
            <field name="act_window" ref="medical_action_list_test"/>
        </record>

        <menuitem parent="medical_conf_laboratory" action="medical_action_list_test"
            id="menu_medical_action_list_test"/>

        <record model="ir.action.act_window" id="medical_action_form_test">
            <field name="name">New Type of Lab test</field>
            <field name="res_model">medical.test_type</field>
        </record>

        <record model="ir.action.act_window.view" id="medical_action_list_test_form_view">
            <field name="sequence" eval="10"/>
            <field name="view" ref="medical_test_view"/>
            <field name="act_window" ref="medical_action_form_test"/>
        </record>

        <menuitem parent="medical_conf_laboratory" action="medical_action_form_test"
            id="medical_conf_test"/>

<!-- Lab Test Results -->

        <record model="ir.ui.view" id="medical_lab_view">
            <field name="model">medical.lab</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <![CDATA[
                <form string="Laboratory Test">
                    <notebook>
                        <page string="Main Info" id="lab_main_info">
                            <label name="name"/>
                            <field name="name"/>
                            <label name="test"/>
                            <field name="test"/>
                            <label name="date_analysis"/>
                            <field name="date_analysis"/>
                            <newline/>
                            <label name="patient"/>
                            <field name="patient"/>
                            <label name="pathologist"/>
                            <field name="pathologist"/>
                            <newline/>
                            <label name="date_requested"/>
                            <field name="date_requested"/>
                            <label name="requestor"/>
                            <field name="requestor"/>

                            <field name="critearea" colspan="4">
                                <tree editable="top" string="Test Cases">
                                    <field name="sequence"/>
                                    <field name="name"/>
                                    <field name="result"/>
                                    <field name="normal_range"/>
                                    <field name="units"/>
                                </tree>
                                <form string="Test Cases">
                                    <label name="name"/>
                                    <field name="name"/>
                                    <label name="result"/>
                                    <field name="result"/>
                                    <label name="units"/>
                                    <field name="units"/>
                                    <label name="normal_range"/>
                                    <field name="normal_range"/>
                                </form>
                            </field>

                        </page>
                        <page string="Extra Info" id="lab_extra_info">
                            <label name="results"/>
                            <field name="results"/>
                            <newline/>
                            <label name="diagnosis"/>
                            <field name="diagnosis"/>
                        </page>
                    </notebook>
                </form>
                ]]>
            </field>
        </record>

        <record model="ir.ui.view" id="medical_lab_tree">
            <field name="model">medical.lab</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <![CDATA[
                <tree string="Lab test type">
                    <field name="name"/>
                    <field name="test"/>
                    <field name="patient"/>
                    <field name="date_analysis"/>
                </tree>
                ]]>
            </field>
        </record>

        <record model="ir.action.act_window" id="medical_action_tree_lab">
            <field name="name">Lab Tests Results</field>
            <field name="res_model">medical.lab</field>
            <field name="context">{'group_by': [], 'search_default_today': 1}</field>
        </record>

        <record model="ir.action.act_window.view" id="medical_action_tree_lab_tree_view">
            <field name="sequence" eval="10"/>
            <field name="view" ref="medical_lab_tree"/>
            <field name="act_window" ref="medical_action_tree_lab"/>
        </record>

        <record model="ir.action.act_window.view" id="medical_action_tree_lab_form_view">
            <field name="sequence" eval="20"/>
            <field name="view" ref="medical_lab_view"/>
            <field name="act_window" ref="medical_action_tree_lab"/>
        </record>

        <menuitem parent="medical_laboratory_menu" action="medical_action_tree_lab"
            id="medical_action_lab_tree" sequence="2"/>

<!-- Shortcut to the Lab Reports from the Patient -->

        <record model="ir.action.act_window" id="act_patient_lab_history_form1">
            <field name="name">Lab Reports</field>
            <field name="res_model">medical.lab</field>
            <field name="domain">[('patient', '=', Eval('active_id'))]</field>
        </record>
        <record model="ir.action.keyword"
                id="act_open_patient_lab_history_keyword1">
            <field name="keyword">form_relate</field>
            <field name="model">medical.patient,0</field>
            <field name="action" ref="act_patient_lab_history_form1"/>
        </record>

    </data>
</tryton>
